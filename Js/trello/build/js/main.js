"use strict";var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var CreateElem=function(){function e(t,a,r,n,d){_classCallCheck(this,e),this.classElement=t,this.tag=r||"div",this.parent=a||document.body,this.innerText=n,this.handler=d}return _createClass(e,[{key:"create",value:function(){var e=document.createElement(this.tag);return e.classList.add(this.classElement),void 0!==this.innerText&&(e.innerText=this.innerText),void 0!==this.handler&&e.addEventListener("click",this.handler,!1),this.parent.appendChild(e),e}},{key:"dragnDrop",value:function(e,t,a){t.addEventListener(a,e,!1)}},{key:"setdraggable",value:function(e){e.setAttribute("draggable","true")}}]),e}(),container=new CreateElem("container").create(),allLists=new CreateElem("allLists",container).create(),addList=new CreateElem("addList",container).create(),btnAddList=new CreateElem("addList__btnAdd",addList,"button","Добавить список ...",addListClick).create();function addListClick(e){this.classList.remove("displayBlock"),this.classList.add("displayNone");var t=new CreateElem("addList__title",addList).create(),a=new CreateElem("addList__title--input",t,"input").create();new CreateElem("addList__title--save",t,"button","Сохранить",saveList).create(),new CreateElem("addList__title--cancel",t,"button","Отмена",cancelList).create();a.focus()}function saveList(e){var t=document.querySelector(".addList__title--input").value,a=new CreateElem("parentList",allLists,"div").create(),r=new CreateElem("list",a,"div"),n=r.create();r.setdraggable(n),r.dragnDrop(dragEnter,n,"dragenter");var d=new CreateElem("list__title",n,"span",t),i=d.create();d.setdraggable(i),d.dragnDrop(dragStart,i,"dragstart"),d.dragnDrop(dragEnter,i,"dragenter"),d.dragnDrop(dragEnd,i,"dragend");new CreateElem("list__title--remove",i,"span",void 0,removeList).create();var s=new CreateElem("list__content",n),l=s.create();s.setdraggable(l),s.dragnDrop(dragEnter,l,"dragenter");var o=new CreateElem("list__addCard",n),c=o.create();o.setdraggable(c),o.dragnDrop(dragEnter,c,"dragenter");new CreateElem("list__addCard--add",c,"button","Добавить карточку...",addCardClick).create();addList.removeChild(this.parentNode),btnAddList.classList.remove("displayNone"),btnAddList.classList.add("displayBlock")}function cancelList(e){addList.removeChild(this.parentNode),btnAddList.classList.remove("displayNone"),btnAddList.classList.add("displayBlock")}function removeList(e){var t=this.parentNode.parentNode.parentNode;this.parentNode.parentNode.parentNode.parentNode.removeChild(t)}function addCardClick(e){this.classList.remove("displayBlock"),this.classList.add("displayNone");var t=new CreateElem("list__addCard--inputData",this.parentNode).create(),a=new CreateElem("list__addCard--textarea",t,"textarea").create();new CreateElem("list__addCard--save",t,"button","Сохранить",saveCard).create(),new CreateElem("list__addCard--cancel",t,"button","Отмена",cancelCard).create();a.focus()}function saveCard(e){var t=document.querySelector(".list__addCard--textarea").value,a=this.parentNode,r=this.parentNode.previousElementSibling,n=this.parentNode.parentNode,d=this.parentNode.parentNode.previousElementSibling,i=new CreateElem("list__content__parentCard",d,"div").create(),s=new CreateElem("list__content__card",i,"div",t),l=s.create();s.setdraggable(l),s.dragnDrop(dragStart,l,"dragstart"),s.dragnDrop(dragEnter,l,"dragenter"),s.dragnDrop(dragEnd,l,"dragend");new CreateElem("list__content__card--redact",l,"span",void 0,redactCard).create();r.classList.remove("displayNone"),r.classList.add("displayBlock"),n.removeChild(a)}function cancelCard(e){var t=this.parentNode,a=this.parentNode.previousElementSibling;this.parentNode.parentNode.removeChild(t),a.classList.remove("displayNone"),a.classList.add("displayBlock")}function redactCard(e){var t=this.parentNode.parentNode,a=this.parentNode,r=this.parentNode.innerText;a.classList.add("displayNone");var n=new CreateElem("redact",t).create(),d=new CreateElem("redact__textarea",n,"textarea").create();new CreateElem("redact__btnSaveCard",n,"button","Сохранить",redactSaveCard).create(),new CreateElem("redact__btnCancelCard",n,"button","Отмена",redactCancelCard).create(),new CreateElem("redact__btnRemoveCard",n,"button","Удалить карточку",removeCard).create();d.value=r,d.focus()}function redactSaveCard(e){var t=document.querySelector(".redact__textarea").value,a=this.parentNode.previousElementSibling,r=this.parentNode.parentNode,n=this.parentNode;r.removeChild(n),a.textContent=t;new CreateElem("list__content__card--redact",a,"span",void 0,redactCard).create();a.classList.remove("displayNone")}function redactCancelCard(e){var t=this.parentNode,a=this.parentNode.parentNode,r=this.parentNode.previousElementSibling;a.removeChild(t),r.classList.remove("displayNone")}function removeCard(e){var t=this.parentNode.parentNode;this.parentNode.parentNode.parentNode.removeChild(t)}var dragObj={};function dragStart(e){var t="list__title"===this.className?this.parentNode:this,a=t.cloneNode(!0);a.classList.add("hiddenCloneElem");var r=getCoords(t),n=e.pageX-r.left,d=e.pageY-r.top;document.body.appendChild(a),e.dataTransfer.setDragImage(a,n,d),dragObj.elem=t,dragObj.parent=t.parentNode,t.classList.add("opacityZero")}function dragEnter(e){var t=void 0;if(dragObj.elem&&dragObj.elem.classList.contains("list"))t=!this.classList.contains("opacityZero")&&!this.parentNode.classList.contains("opacityZero")&&!this.parentNode.parentNode.parentNode.classList.contains("opacityZero");else{if(t=dragObj.elem&&this.parentNode.children[1]&&dragObj.elem.classList.contains("list__content__card")&&(this.classList.contains("list__title")||this.classList.contains("list__addCard")))return this.classList.contains("list__addCard")||0==this.parentNode.children[1].children.length?this.parentNode.children[1].appendChild(dragObj.parent):this.parentNode.children[1].insertBefore(dragObj.parent,this.parentNode.children[1].children[0]),void(t=!1);t=dragObj.elem&&!this.classList.contains("opacityZero")&&this.classList.contains("list__content__card")&&dragObj.elem.classList.contains("list__content__card")}if(t){var a=getCoords(this),r=dragObj.elem.classList.contains("list")?e.pageX-a.left>=100:e.pageY-a.top>=10,n=this.parentNode;if(dragObj.elem.classList.contains("list")&&(n=this.classList.contains("list")?this.parentNode:this.classList.contains("list__content__card")?this.parentNode.parentNode.parentNode.parentNode:this.parentNode.parentNode),r)if(null==n.nextElementSibling){var d=dragObj.parent.parentNode.removeChild(dragObj.parent);n.parentNode.appendChild(d)}else if(null==n.previousElementSibling)n.parentNode.insertBefore(dragObj.parent,n);else if(n.nextElementSibling==dragObj.parent)n.parentNode.insertBefore(dragObj.parent,n);else{var i=n.parentNode.replaceChild(dragObj.parent,n);dragObj.parent.parentNode.insertBefore(i,dragObj.parent)}else if(null==n.previousElementSibling)n.parentNode.insertBefore(dragObj.parent,n);else if(n.previousElementSibling==dragObj.parent)n.parentNode.insertBefore(n,dragObj.parent);else if(null==n.nextElementSibling){var s=dragObj.parent.parentNode.removeChild(dragObj.parent);n.parentNode.appendChild(s)}else n.parentNode.insertBefore(dragObj.parent,n)}}function dragEnd(e){var t="list__title"===this.className?this.parentNode:this;document.body.removeChild(document.querySelector(".hiddenCloneElem")),t.classList.remove("opacityZero"),dragObj={}}function getCoords(e){var t=e.getBoundingClientRect();return{top:t.top+pageYOffset,left:t.left+pageXOffset}}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiQ3JlYXRlRWxlbSIsImNsYXNzRWxlbWVudCIsInBhcmVudCIsInRhZyIsImlubmVyVGV4dCIsImhhbmRsZXIiLCJfY2xhc3NDYWxsQ2hlY2siLCJ0aGlzIiwiZG9jdW1lbnQiLCJib2R5IiwiZWxlbSIsImNyZWF0ZUVsZW1lbnQiLCJhZGQiLCJ1bmRlZmluZWQiLCJhZGRFdmVudExpc3RlbmVyIiwiYXBwZW5kQ2hpbGQiLCJjbGFzc0xpc3QiLCJldmVudCIsInNldEF0dHJpYnV0ZSIsImNvbnRhaW5lciIsImNyZWF0ZSIsImFsbExpc3RzIiwiYWRkTGlzdCIsImJ0bkFkZExpc3QiLCJhZGRMaXN0Q2xpY2siLCJlIiwicmVtb3ZlIiwiaW5wdXRUaXRsZSIsImlucHV0Iiwic2F2ZUxpc3QiLCJjYW5jZWxMaXN0IiwiZm9jdXMiLCJ0aXRsZSIsInF1ZXJ5U2VsZWN0b3IiLCJ2YWx1ZSIsInBhcmVudExpc3QiLCJsaXN0RWxlbSIsImxpc3QiLCJzZXRkcmFnZ2FibGUiLCJkcmFnRW50ZXIiLCJsaXN0VGl0bGVFbGVtIiwibGlzdFRpdGxlIiwiZHJhZ1N0YXJ0Iiwic2F2ZSIsImNhbmNlbCIsImRyYWduRHJvcCIsInJlbW92ZUxpc3QiLCJsaXN0Q29udGVudCIsImxpc3RDb250ZW50RWxlbSIsImFkZENhcmRFbGVtIiwiYWRkQ2FyZENsaWNrIiwiZGVsZXRlTGlzdCIsInJlbW92ZUNoaWxkIiwicGFyZW50Tm9kZSIsImFkZENhcmQiLCJpbnB1dERhdGEiLCJ0ZXh0YXJlYSIsInNhdmVDYXJkIiwiY2FuY2VsQ2FyZCIsInByZXZpb3VzRWxlbWVudFNpYmxpbmciLCJwYXJlbnRDYXJkIiwiY2FyZEVsZW0iLCJjYXJkIiwiYnRuU2F2ZSIsImJ0bkFkZCIsImRyYWdFbmQiLCJyZWRhY3RJY29uIiwiY2FyZFZhbHVlIiwicmVkYWN0IiwicmVkYWN0U2F2ZUNhcmQiLCJyZWRhY3RDYW5jZWxDYXJkIiwicmVtb3ZlQ2FyZCIsInJlZGFjdENhcmQiLCJyZWRhY3RCbG9jayIsInBhcmVudFJlZGFjdCIsInRleHRDb250ZW50IiwiZHJhZ09iaiIsImNvb3JkcyIsImdldENvb3JkcyIsImRlbHRhWCIsInBhZ2VYIiwibGVmdCIsImRlbHRhWSIsInBhZ2VZIiwidG9wIiwic2V0RHJhZ0ltYWdlIiwiY2xvbmVFbGVtIiwiY29udGFpbnMiLCJ2YWxpZEVudGVyIiwiY2hpbGRyZW4iLCJzaWRlIiwibmV4dEVsZW1lbnRTaWJsaW5nIiwiZHJhZ1BhcmVudCIsImluc2VydEJlZm9yZSIsImVsZW1QYXJlbnQiLCJjbGFzc05hbWUiLCJib3giLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJwYWdlWU9mZnNldCIsInBhZ2VYT2Zmc2V0Il0sIm1hcHBpbmdzIjoiaVlBQU1BLHNCQUNGLFNBQUFBLEVBQVlDLEVBQWNDLEVBQVFDLEVBQUtDLEVBQVdDLEdBQVNDLGdCQUFBQyxLQUFBUCxHQUN6RE8sS0FBS04sYUFBZUEsRUFDcEJNLEtBQUtKLElBQU1BLEdBQU8sTUFDbEJJLEtBQUtMLE9BQVNBLEdBQVVNLFNBQVNDLEtBQ2pDRixLQUFLSCxVQUFZQSxFQUxqQkosS0FBQUEsUUFNZUssd0RBR2YsSUFBSUssRUFBT0YsU0FBU0csY0FBY0osS0FBS0osS0FTdkMsT0FoQkFPLEVBQUtULFVBQUxXLElBQW9CWCxLQUFBQSxtQkFDcEJZLElBQUtWLEtBQU1BLFlBQ1hPLEVBQUtSLFVBQVNBLEtBQVVNLGdCQUV4QkssSUFBS1IsS0FBQUEsU0FDTkssRUFBQUksaUJBQUEsUUFBQVAsS0FBQUYsU0FBQSxHQVVDRSxLQUFLTCxPQUFPYSxZQUFZTCxHQUNqQkEsb0NBVEhBLEVBQU9GLEVBQVNHLEdBQ3BCRCxFQUFLTSxpQkFBY0MsRUFBS2hCLEdBQXhCLHdDQUVPRyxHQUNOTSxFQUFBUSxhQUFBLFlBQUEsaUJBS0RDLFVBQUEsSUFBQW5CLFdBQUEsYUFBQW9CLFNBQ0RDLFNBQUEsSUFBQXJCLFdBQUEsV0FBQW1CLFdBQUFDLFNBWURFLFFBQVUsSUFBSXRCLFdBQVcsVUFB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LGVBQ3RCa0QsV0FJRixTQUFVRSxVQUFVcEUsR0FDbEIsSUFBSXNGLEVBQU10RixFQUFLdUYsd0JBQ2YsT0FDRWIsSUFBS1ksRUFBSVosSUFBTWMsWUFDZmpCLEtBQU1lLEVBQUlmLEtBQU9rQiIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgQ3JlYXRlRWxlbSB7XHJcbiAgICBjb25zdHJ1Y3RvcihjbGFzc0VsZW1lbnQsIHBhcmVudCwgdGFnLCBpbm5lclRleHQsIGhhbmRsZXIpIHtcclxuICAgICAgdGhpcy5jbGFzc0VsZW1lbnQgPSBjbGFzc0VsZW1lbnQ7XHJcbiAgICAgIHRoaXMudGFnID0gdGFnIHx8IFwiZGl2XCI7XHJcbiAgICAgIHRoaXMucGFyZW50ID0gcGFyZW50IHx8IGRvY3VtZW50LmJvZHk7XHJcbiAgICAgIHRoaXMuaW5uZXJUZXh0ID0gaW5uZXJUZXh0O1xyXG4gICAgICB0aGlzLmhhbmRsZXIgPSBoYW5kbGVyO1xyXG4gICAgfVxyXG4gICAgY3JlYXRlKCl7XHJcbiAgICAgIGxldCBlbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0aGlzLnRhZyk7XHJcbiAgICAgIGVsZW0uY2xhc3NMaXN0LmFkZCh0aGlzLmNsYXNzRWxlbWVudCk7XHJcbiAgICAgIGlmICh0aGlzLmlubmVyVGV4dCAhPT0gdW5kZWZpbmVkKSB7IFxyXG4gICAgICAgIGVsZW0uaW5uZXJUZXh0ID0gdGhpcy5pbm5lclRleHQ7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHRoaXMuaGFuZGxlciAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5oYW5kbGVyLCBmYWxzZSk7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5wYXJlbnQuYXBwZW5kQ2hpbGQoZWxlbSk7XHJcbiAgICAgIHJldHVybiBlbGVtO1xyXG4gICAgfVxyXG4gICAgZHJhZ25Ecm9wKGhhbmRsZXIsIGVsZW0sIGV2ZW50KSB7XHJcbiAgICAgIGVsZW0uYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgaGFuZGxlciwgZmFsc2UpO1xyXG4gICAgfVxyXG4gICAgc2V0ZHJhZ2dhYmxlKGVsZW0pIHtcclxuICAgICAgZWxlbS5zZXRBdHRyaWJ1dGUoXCJkcmFnZ2FibGVcIiwgXCJ0cnVlXCIpO1xyXG4gICAgfVxyXG4gIH1cclxuICBcclxuLy89PT09PSDQodCe0JfQlNCQ0J3QmNCVINCh0KLQkNCg0KLQntCS0J7QmSDQodCi0KDQkNCd0JjQptCrPT09PT1cclxuICBsZXQgY29udGFpbmVyID0gbmV3IENyZWF0ZUVsZW0oXCJjb250YWluZXJcIikuY3JlYXRlKCksXHJcbiAgICBhbGxMaXN0cyA9IG5ldyBDcmVhdGVFbGVtKFwiYWxsTGlzdHNcIiwgY29udGFpbmVyKS5jcmVhdGUoKSxcclxuICAgIGFkZExpc3QgPSBuZXcgQ3JlYXRlRWxlbShcImFkZExpc3RcIiwgY29udGFpbmVyKS5jcmVhdGUoKSxcclxuICAgIGJ0bkFkZExpc3QgPSBuZXcgQ3JlYXRlRWxlbShcImFkZExpc3RfX2J0bkFkZFwiLCBhZGRMaXN0LCBcImJ1dHRvblwiLCBcItCU0L7QsdCw0LLQuNGC0Ywg0YHQv9C40YHQvtC6IC4uLlwiLCBhZGRMaXN0Q2xpY2spLmNyZWF0ZSgpO1xyXG4gIFxyXG5cclxuLy89PT09PdCU0J7QkdCQ0JLQm9CV0J3QmNCVINCh0J/QmNCh0JrQkD09PT09XHJcbiAgZnVuY3Rpb24gYWRkTGlzdENsaWNrKGUpIHtcclxuICAgIHRoaXMuY2xhc3NMaXN0LnJlbW92ZShcImRpc3BsYXlCbG9ja1wiKTtcclxuICAgIHRoaXMuY2xhc3NMaXN0LmFkZChcImRpc3BsYXlOb25lXCIpO1xyXG4gICAgXHJcbiAgICBsZXQgaW5wdXRUaXRsZSA9IG5ldyBDcmVhdGVFbGVtKFwiYWRkTGlzdF9fdGl0bGVcIiwgYWRkTGlzdCkuY3JlYXRlKCksIFxyXG4gICAgICBpbnB1dCA9IG5ldyBDcmVhdGVFbGVtKFwiYWRkTGlzdF9fdGl0bGUtLWlucHV0XCIsIGlucHV0VGl0bGUsIFwiaW5wdXRcIikuY3JlYXRlKCksXHJcbiAgICAgIHNhdmUgPSBuZXcgQ3JlYXRlRWxlbShcImFkZExpc3RfX3RpdGxlLS1zYXZlXCIsIGlucHV0VGl0bGUsIFwiYnV0dG9uXCIsIFwi0KHQvtGF0YDQsNC90LjRgtGMXCIsIHNhdmVMaXN0KS5jcmVhdGUoKSxcclxuICAgICAgY2FuY2VsID0gbmV3IENyZWF0ZUVsZW0oXCJhZGRMaXN0X190aXRsZS0tY2FuY2VsXCIsIGlucHV0VGl0bGUsIFwiYnV0dG9uXCIsIFwi0J7RgtC80LXQvdCwXCIsIGNhbmNlbExpc3QpLmNyZWF0ZSgpO1xyXG4gICAgICBpbnB1dC5mb2N1cygpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc2F2ZUxpc3QoZSkge1xyXG4gICAgbGV0ICB0aXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hZGRMaXN0X190aXRsZS0taW5wdXQnKS52YWx1ZTtcclxuXHJcbiAgICAvL9GB0L7Qt9C00LDQvdC40LUg0YHQv9C40YHQutCwXHJcbiAgICBsZXQgcGFyZW50TGlzdCA9IG5ldyBDcmVhdGVFbGVtKFwicGFyZW50TGlzdFwiLCBhbGxMaXN0cywgXCJkaXZcIikuY3JlYXRlKCk7XHJcbiAgICBsZXQgbGlzdCA9IG5ldyBDcmVhdGVFbGVtKFwibGlzdFwiLCBwYXJlbnRMaXN0LCBcImRpdlwiKSxcclxuICAgICAgICBsaXN0RWxlbSA9IGxpc3QuY3JlYXRlKCk7XHJcbiAgICAgICAgbGlzdC5zZXRkcmFnZ2FibGUobGlzdEVsZW0pO1xyXG4gICAgICAgIGxpc3QuZHJhZ25Ecm9wKGRyYWdFbnRlciwgbGlzdEVsZW0sIFwiZHJhZ2VudGVyXCIpO1xyXG5cclxuICAgIGxldCBsaXN0VGl0bGUgPSBuZXcgQ3JlYXRlRWxlbShcImxpc3RfX3RpdGxlXCIsIGxpc3RFbGVtLCBcInNwYW5cIiwgdGl0bGUpLFxyXG4gICAgICAgIGxpc3RUaXRsZUVsZW0gPSBsaXN0VGl0bGUuY3JlYXRlKCk7XHJcbiAgICAgICAgbGlzdFRpdGxlLnNldGRyYWdnYWJsZShsaXN0VGl0bGVFbGVtKTtcclxuICAgICAgICBsaXN0VGl0bGUuZHJhZ25Ecm9wKGRyYWdTdGFydCwgbGlzdFRpdGxlRWxlbSwgXCJkcmFnc3RhcnRcIik7XHJcbiAgICAgICAgbGlzdFRpdGxlLmRyYWduRHJvcChkcmFnRW50ZXIsIGxpc3RUaXRsZUVsZW0sIFwiZHJhZ2VudGVyXCIpO1xyXG4gICAgICAgIGxpc3RUaXRsZS5kcmFnbkRyb3AoZHJhZ0VuZCwgbGlzdFRpdGxlRWxlbSwgXCJkcmFnZW5kXCIpO1xyXG4gICAgbGV0IGRlbGV0ZUxpc3QgPSBuZXcgQ3JlYXRlRWxlbShcImxpc3RfX3RpdGxlLS1yZW1vdmVcIiwgbGlzdFRpdGxlRWxlbSwgXCJzcGFuXCIsIHVuZGVmaW5lZCwgcmVtb3ZlTGlzdCkuY3JlYXRlKCk7XHJcblxyXG4gICAgbGV0IGxpc3RDb250ZW50ID0gbmV3IENyZWF0ZUVsZW0oXCJsaXN0X19jb250ZW50XCIsIGxpc3RFbGVtKSxcclxuICAgICAgICBsaXN0Q29udGVudEVsZW0gPSBsaXN0Q29udGVudC5jcmVhdGUoKTtcclxuICAgICAgICBsaXN0Q29udGVudC5zZXRkcmFnZ2FibGUobGlzdENvbnRlbnRFbGVtKTtcclxuICAgICAgICBsaXN0Q29udGVudC5kcmFnbkRyb3AoZHJhZ0VudGVyLCBsaXN0Q29udGVudEVsZW0sIFwiZHJhZ2VudGVyXCIpO1xyXG5cclxuICAgIGxldCBhZGRDYXJkID0gbmV3IENyZWF0ZUVsZW0oXCJsaXN0X19hZGRDYXJkXCIsIGxpc3RFbGVtKSxcclxuICAgICAgICBhZGRDYXJkRWxlbSA9IGFkZENhcmQuY3JlYXRlKCk7XHJcbiAgICAgICAgYWRkQ2FyZC5zZXRkcmFnZ2FibGUoYWRkQ2FyZEVsZW0pO1xyXG4gICAgICAgIGFkZENhcmQuZHJhZ25Ecm9wKGRyYWdFbnRlciwgYWRkQ2FyZEVsZW0sIFwiZHJhZ2VudGVyXCIpO1xyXG5cclxuICAgIGxldCBidXRBZGQgPSBuZXcgQ3JlYXRlRWxlbShcImxpc3RfX2FkZENhcmQtLWFkZFwiLCBhZGRDYXJkRWxlbSwgXCJidXR0b25cIiwgXCLQlNC+0LHQsNCy0LjRgtGMINC60LDRgNGC0L7Rh9C60YMuLi5cIiwgYWRkQ2FyZENsaWNrKS5jcmVhdGUoKTtcclxuXHJcbiAgICBhZGRMaXN0LnJlbW92ZUNoaWxkKHRoaXMucGFyZW50Tm9kZSk7XHJcbiAgICBidG5BZGRMaXN0LmNsYXNzTGlzdC5yZW1vdmUoXCJkaXNwbGF5Tm9uZVwiKTtcclxuICAgIGJ0bkFkZExpc3QuY2xhc3NMaXN0LmFkZChcImRpc3BsYXlCbG9ja1wiKTtcclxuICB9XHJcbiBcclxuICBmdW5jdGlvbiBjYW5jZWxMaXN0KGUpIHtcclxuICAgIGFkZExpc3QucmVtb3ZlQ2hpbGQodGhpcy5wYXJlbnROb2RlKTtcclxuICAgIGJ0bkFkZExpc3QuY2xhc3NMaXN0LnJlbW92ZShcImRpc3BsYXlOb25lXCIpO1xyXG4gICAgYnRuQWRkTGlzdC5jbGFzc0xpc3QuYWRkKFwiZGlzcGxheUJsb2NrXCIpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcmVtb3ZlTGlzdChlKSB7XHJcbiAgICBsZXQgbGlzdCA9IHRoaXMucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUsXHJcbiAgICAgIGFsbExpc3RzID0gdGhpcy5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlO1xyXG4gICAgYWxsTGlzdHMucmVtb3ZlQ2hpbGQobGlzdCk7XHJcbiAgfVxyXG5cclxuLy89PT09PdCU0J7QkdCQ0JLQm9CV0J3QmNCVINCa0JDQoNCi0J7Qp9Ca0Jgg0JIg0KHQn9CY0KHQntCaPT09PT1cclxuICBmdW5jdGlvbiBhZGRDYXJkQ2xpY2soZSkge1xyXG4gICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKFwiZGlzcGxheUJsb2NrXCIpO1xyXG4gICAgdGhpcy5jbGFzc0xpc3QuYWRkKFwiZGlzcGxheU5vbmVcIik7XHJcbiAgICBcclxuICAgIGxldCBpbnB1dERhdGEgPSBuZXcgQ3JlYXRlRWxlbShcImxpc3RfX2FkZENhcmQtLWlucHV0RGF0YVwiLCB0aGlzLnBhcmVudE5vZGUpLmNyZWF0ZSgpLFxyXG4gICAgICB0ZXh0YXJlYSA9IG5ldyBDcmVhdGVFbGVtKFwibGlzdF9fYWRkQ2FyZC0tdGV4dGFyZWFcIiwgaW5wdXREYXRhLCBcInRleHRhcmVhXCIpLmNyZWF0ZSgpLFxyXG4gICAgICBidG5TYXZlID0gbmV3IENyZWF0ZUVsZW0oXCJsaXN0X19hZGRDYXJkLS1zYXZlXCIsIGlucHV0RGF0YSwgXCJidXR0b25cIiwgXCLQodC+0YXRgNCw0L3QuNGC0YxcIiwgc2F2ZUNhcmQpLmNyZWF0ZSgpLFxyXG4gICAgICBidG5DYW5jZWwgPSBuZXcgQ3JlYXRlRWxlbShcImxpc3RfX2FkZENhcmQtLWNhbmNlbFwiLCBpbnB1dERhdGEsIFwiYnV0dG9uXCIsIFwi0J7RgtC80LXQvdCwXCIsIGNhbmNlbENhcmQpLmNyZWF0ZSgpO1xyXG4gICAgICB0ZXh0YXJlYS5mb2N1cygpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc2F2ZUNhcmQoZSkge1xyXG4gICAgbGV0IHZhbHVlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5saXN0X19hZGRDYXJkLS10ZXh0YXJlYVwiKS52YWx1ZSxcclxuICAgICAgaW5wdXREYXRhID0gdGhpcy5wYXJlbnROb2RlLFxyXG4gICAgICBidG5BZGQgPSB0aGlzLnBhcmVudE5vZGUucHJldmlvdXNFbGVtZW50U2libGluZyxcclxuICAgICAgYWRkQ2FyZCA9IHRoaXMucGFyZW50Tm9kZS5wYXJlbnROb2RlLFxyXG4gICAgICBsaXN0Q29udGVudCA9IHRoaXMucGFyZW50Tm9kZS5wYXJlbnROb2RlLnByZXZpb3VzRWxlbWVudFNpYmxpbmc7XHJcblxyXG4gICAgLy/RgdC+0LTQsNC10Lwg0LrQsNGA0YLQvtGH0LrRgyDQuCDQtNC+0LHQsNCy0LvRj9C10Lwg0LXQtSDQsiDRgdC/0LjRgdC+0LpcclxuICAgIGxldCBwYXJlbnRDYXJkID0gbmV3IENyZWF0ZUVsZW0oXCJsaXN0X19jb250ZW50X19wYXJlbnRDYXJkXCIsIGxpc3RDb250ZW50LCBcImRpdlwiKS5jcmVhdGUoKTtcclxuICAgIGxldCBjYXJkID0gIG5ldyBDcmVhdGVFbGVtKFwibGlzdF9fY29udGVudF9fY2FyZFwiLCBwYXJlbnRDYXJkLCBcImRpdlwiLCB2YWx1ZSksXHJcbiAgICAgIGNhcmRFbGVtID0gY2FyZC5jcmVhdGUoKTtcclxuICAgICAgY2FyZC5zZXRkcmFnZ2FibGUoY2FyZEVsZW0pO1xyXG4gICAgICBjYXJkLmRyYWduRHJvcChkcmFnU3RhcnQsIGNhcmRFbGVtLCBcImRyYWdzdGFydFwiKTtcclxuICAgICAgY2FyZC5kcmFnbkRyb3AoZHJhZ0VudGVyLCBjYXJkRWxlbSwgXCJkcmFnZW50ZXJcIik7XHJcbiAgICAgIGNhcmQuZHJhZ25Ecm9wKGRyYWdFbmQsIGNhcmRFbGVtLCBcImRyYWdlbmRcIik7XHJcbiAgbGV0IHJlZGFjdEljb24gPSAgbmV3IENyZWF0ZUVsZW0oXCJsaXN0X19jb250ZW50X19jYXJkLS1yZWRhY3RcIiwgY2FyZEVsZW0sIFwic3BhblwiLCB1bmRlZmluZWQsIHJlZGFjdENhcmQpLmNyZWF0ZSgpO1xyXG5cclxuICAgIGJ0bkFkZC5jbGFzc0xpc3QucmVtb3ZlKFwiZGlzcGxheU5vbmVcIik7XHJcbiAgICBidG5BZGQuY2xhc3NMaXN0LmFkZChcImRpc3BsYXlCbG9ja1wiKTtcclxuICAgIGFkZENhcmQucmVtb3ZlQ2hpbGQoaW5wdXREYXRhKTtcclxuICAgICAgICBcclxuICB9XHJcbiAgZnVuY3Rpb24gY2FuY2VsQ2FyZChlKSB7XHJcbiAgICBsZXQgaW5wdXREYXRhID0gdGhpcy5wYXJlbnROb2RlLFxyXG4gICAgICBidG5BZGQgPSB0aGlzLnBhcmVudE5vZGUucHJldmlvdXNFbGVtZW50U2libGluZyxcclxuICAgICAgYWRkQ2FyZCA9IHRoaXMucGFyZW50Tm9kZS5wYXJlbnROb2RlO1xyXG4gICAgICBcclxuICAgICAgYWRkQ2FyZC5yZW1vdmVDaGlsZChpbnB1dERhdGEpO1xyXG4gICAgICBidG5BZGQuY2xhc3NMaXN0LnJlbW92ZShcImRpc3BsYXlOb25lXCIpO1xyXG4gICAgICBidG5BZGQuY2xhc3NMaXN0LmFkZChcImRpc3BsYXlCbG9ja1wiKTtcclxuICB9XHJcbiAgLy/RgNC10LTQsNC60YLQuNGA0L7QstCw0L3QuNC1INC60LDRgNGC0L7Rh9C60LhcclxuICBmdW5jdGlvbiByZWRhY3RDYXJkKGUpIHtcclxuICAgIGxldCBwYXJlbnRDYXJkID0gdGhpcy5wYXJlbnROb2RlLnBhcmVudE5vZGUsXHJcbiAgICAgICAgY2FyZCA9IHRoaXMucGFyZW50Tm9kZSxcclxuICAgICAgICBjYXJkVmFsdWUgPSB0aGlzLnBhcmVudE5vZGUuaW5uZXJUZXh0O1xyXG4gICAgICAgIFxyXG4gICAgY2FyZC5jbGFzc0xpc3QuYWRkKFwiZGlzcGxheU5vbmVcIik7XHJcblxyXG4gICAgbGV0IHJlZGFjdCA9IG5ldyBDcmVhdGVFbGVtKFwicmVkYWN0XCIsIHBhcmVudENhcmQpLmNyZWF0ZSgpLFxyXG4gICAgICB0ZXh0YXJlYSA9IG5ldyBDcmVhdGVFbGVtKFwicmVkYWN0X190ZXh0YXJlYVwiLCByZWRhY3QsIFwidGV4dGFyZWFcIikuY3JlYXRlKCksXHJcbiAgICAgIGJ0blNhdmUgPSBuZXcgQ3JlYXRlRWxlbShcInJlZGFjdF9fYnRuU2F2ZUNhcmRcIiwgcmVkYWN0LCBcImJ1dHRvblwiLCBcItCh0L7RhdGA0LDQvdC40YLRjFwiLCByZWRhY3RTYXZlQ2FyZCkuY3JlYXRlKCksXHJcbiAgICAgIGJ0bkNhbmNlbCA9IG5ldyBDcmVhdGVFbGVtKFwicmVkYWN0X19idG5DYW5jZWxDYXJkXCIsIHJlZGFjdCwgXCJidXR0b25cIiwgXCLQntGC0LzQtdC90LBcIiwgcmVkYWN0Q2FuY2VsQ2FyZCkuY3JlYXRlKCksXHJcbiAgICAgIGJ0blJlbW92ZUNhcmQgPSBuZXcgQ3JlYXRlRWxlbShcInJlZGFjdF9fYnRuUmVtb3ZlQ2FyZFwiLCByZWRhY3QsIFwiYnV0dG9uXCIsIFwi0KPQtNCw0LvQuNGC0Ywg0LrQsNGA0YLQvtGH0LrRg1wiLCByZW1vdmVDYXJkKS5jcmVhdGUoKTtcclxuICAgICAgXHJcbiAgICAgIHRleHRhcmVhLnZhbHVlID0gY2FyZFZhbHVlO1xyXG4gICAgICB0ZXh0YXJlYS5mb2N1cygpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcmVkYWN0U2F2ZUNhcmQoZSkge1xyXG4gICAgbGV0IHZhbHVlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yZWRhY3RfX3RleHRhcmVhXCIpLnZhbHVlLFxyXG4gICAgICBjYXJkID0gdGhpcy5wYXJlbnROb2RlLnByZXZpb3VzRWxlbWVudFNpYmxpbmcsXHJcbiAgICAgIHBhcmVudENhcmQgPSB0aGlzLnBhcmVudE5vZGUucGFyZW50Tm9kZSxcclxuICAgICAgcmVkYWN0QmxvY2sgPSB0aGlzLnBhcmVudE5vZGU7XHJcblxyXG4gICAgcGFyZW50Q2FyZC5yZW1vdmVDaGlsZChyZWRhY3RCbG9jayk7XHJcblxyXG4gICAgY2FyZC50ZXh0Q29udGVudCAgPSB2YWx1ZTtcclxuICAgIGxldCByZWRhY3RJY29uID0gIG5ldyBDcmVhdGVFbGVtKFwibGlzdF9fY29udGVudF9fY2FyZC0tcmVkYWN0XCIsIGNhcmQsIFwic3BhblwiLCB1bmRlZmluZWQsIHJlZGFjdENhcmQpLmNyZWF0ZSgpO1xyXG4gICAgY2FyZC5jbGFzc0xpc3QucmVtb3ZlKFwiZGlzcGxheU5vbmVcIik7ICAgXHJcblxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcmVkYWN0Q2FuY2VsQ2FyZChlKSB7XHJcbiAgICBsZXQgcmVkYWN0ID0gdGhpcy5wYXJlbnROb2RlLFxyXG4gICAgICBwYXJlbnRSZWRhY3QgPSB0aGlzLnBhcmVudE5vZGUucGFyZW50Tm9kZSxcclxuICAgICAgY2FyZCA9IHRoaXMucGFyZW50Tm9kZS5wcmV2aW91c0VsZW1lbnRTaWJsaW5nO1xyXG5cclxuICAgICAgcGFyZW50UmVkYWN0LnJlbW92ZUNoaWxkKHJlZGFjdCk7XHJcbiAgICAgIGNhcmQuY2xhc3NMaXN0LnJlbW92ZShcImRpc3BsYXlOb25lXCIpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcmVtb3ZlQ2FyZChlKSB7XHJcbiAgICBsZXQgY2FyZCA9IHRoaXMucGFyZW50Tm9kZS5wYXJlbnROb2RlLFxyXG4gICAgICBwYXJlbnRDYXJkID0gdGhpcy5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZTtcclxuICAgIHBhcmVudENhcmQucmVtb3ZlQ2hpbGQoY2FyZCk7XHJcbiAgfVxyXG4gXHJcbi8vPT09PT3Qn9CV0KDQldCi0JDQodCa0JjQktCQ0J3QmNCVINCa0JDQoNCi0J7Qp9Ca0Jgg0Jgg0KHQn9CY0KHQmtCQPT09PT1cclxuICBsZXQgZHJhZ09iaiA9IHt9O1xyXG4gIGZ1bmN0aW9uIGRyYWdTdGFydChlKSB7XHJcbiAgICBsZXQgZWxlbSA9IHRoaXMuY2xhc3NOYW1lID09PSBcImxpc3RfX3RpdGxlXCIgPyBcclxuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50Tm9kZSA6IHRoaXM7XHJcbiAgICBcclxuICAgIC8v0LrQu9C+0L3QuNGA0YPQtdC8INC/0LXRgNC10YLQsNGB0LrQuNCy0LDQtdC80YvQuSDRjdC70LXQvNC10L3RgiDQuCDQstC10YjQsNC10Lwg0LXQs9C+INC90LAg0LrRg9GA0YHQvtGAXHJcbiAgICBsZXQgY2xvbmVFbGVtID0gZWxlbS5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgICAgIGNsb25lRWxlbS5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuQ2xvbmVFbGVtXCIpO1xyXG4gICAgbGV0IGNvb3JkcyA9IGdldENvb3JkcyhlbGVtKSxcclxuICAgICAgICBkZWx0YVggPSBlLnBhZ2VYIC0gY29vcmRzLmxlZnQsXHJcbiAgICAgICAgZGVsdGFZID0gZS5wYWdlWSAtIGNvb3Jkcy50b3A7XHJcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGNsb25lRWxlbSk7XHJcbiAgICBlLmRhdGFUcmFuc2Zlci5zZXREcmFnSW1hZ2UoY2xvbmVFbGVtLCBkZWx0YVgsIGRlbHRhWSk7XHJcblxyXG4gICAgLy/Qt9Cw0L/QuNGB0YvQstCw0LXQvCDQtNCw0L3QvdGL0LUg0L7QsSDRjdC70LXQvNC10L3RgtC1INCyINCz0LvQvtCx0LDQu9GM0L3Ri9C5INC+0LHRjNC10LrRglxyXG4gICAgZHJhZ09iai5lbGVtID0gZWxlbTtcclxuICAgIGRyYWdPYmoucGFyZW50ID0gZWxlbS5wYXJlbnROb2RlO1xyXG5cclxuICAgIGVsZW0uY2xhc3NMaXN0LmFkZChcIm9wYWNpdHlaZXJvXCIpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZHJhZ0VudGVyKGUpIHtcclxuICAgIGxldCB2YWxpZEVudGVyO1xyXG4gICAgaWYgKGRyYWdPYmouZWxlbSAmJiBkcmFnT2JqLmVsZW0uY2xhc3NMaXN0LmNvbnRhaW5zKFwibGlzdFwiKSkge1xyXG4gICAgICAvL9GD0YHQu9C+0LLQuNGPINC/0LXRgNC10L3QvtGB0LAg0LvQuNGB0YLQvtCyXHJcbiAgICAgIHZhbGlkRW50ZXIgPSAhKHRoaXMuY2xhc3NMaXN0LmNvbnRhaW5zKFwib3BhY2l0eVplcm9cIikpICYmXHJcbiAgICAgICAgISh0aGlzLnBhcmVudE5vZGUuY2xhc3NMaXN0LmNvbnRhaW5zKFwib3BhY2l0eVplcm9cIikpICYmIFxyXG4gICAgICAgICEodGhpcy5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QuY29udGFpbnMoXCJvcGFjaXR5WmVyb1wiKSk7XHJcbiAgICBcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8v0YPRgdC70L7QstC40LUg0L/QtdGA0LXQvdC+0YHQsCDQutCw0YDRgtC+0YfQutC4INCyINC/0YPRgdGC0L7QuSDQu9C40YHRglxyXG4gICAgICB2YWxpZEVudGVyID0gZHJhZ09iai5lbGVtICYmXHJcbiAgICAgICAgICB0aGlzLnBhcmVudE5vZGUuY2hpbGRyZW5bMV0gJiZcclxuICAgICAgICAgIGRyYWdPYmouZWxlbS5jbGFzc0xpc3QuY29udGFpbnMoXCJsaXN0X19jb250ZW50X19jYXJkXCIpICYmXHJcbiAgICAgICAgICAodGhpcy5jbGFzc0xpc3QuY29udGFpbnMoXCJsaXN0X190aXRsZVwiKSB8fCBcclxuICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LmNvbnRhaW5zKFwibGlzdF9fYWRkQ2FyZFwiKSk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAodmFsaWRFbnRlcikge1xyXG4gICAgICAgIHRoaXMuY2xhc3NMaXN0LmNvbnRhaW5zKFwibGlzdF9fYWRkQ2FyZFwiKSB8fCBcclxuICAgICAgICB0aGlzLnBhcmVudE5vZGUuY2hpbGRyZW5bMV0uY2hpbGRyZW4ubGVuZ3RoID09IDAgP1xyXG4gICAgICAgIHRoaXMucGFyZW50Tm9kZS5jaGlsZHJlblsxXS5hcHBlbmRDaGlsZChkcmFnT2JqLnBhcmVudCkgOlxyXG4gICAgICAgIHRoaXMucGFyZW50Tm9kZS5jaGlsZHJlblsxXS5pbnNlcnRCZWZvcmUoZHJhZ09iai5wYXJlbnQsIHRoaXMucGFyZW50Tm9kZS5jaGlsZHJlblsxXS5jaGlsZHJlblswXSk7XHJcbiAgICAgICAgdmFsaWRFbnRlciA9IGZhbHNlO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfSBcclxuICAgICAgXHJcbiAgICAgIC8v0YPRgdC70L7QstC40LUg0L/QtdGA0LXQvdC+0YHQsCDQutCw0YDRgtC+0YfQtdC6XHJcbiAgICAgIHZhbGlkRW50ZXIgPSBkcmFnT2JqLmVsZW0gJiZcclxuICAgICAgICAhKHRoaXMuY2xhc3NMaXN0LmNvbnRhaW5zKFwib3BhY2l0eVplcm9cIikpICYmIFxyXG4gICAgICAgIHRoaXMuY2xhc3NMaXN0LmNvbnRhaW5zKFwibGlzdF9fY29udGVudF9fY2FyZFwiKSAmJlxyXG4gICAgICAgIGRyYWdPYmouZWxlbS5jbGFzc0xpc3QuY29udGFpbnMoXCJsaXN0X19jb250ZW50X19jYXJkXCIpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAoIXZhbGlkRW50ZXIpIHJldHVybjsgXHJcbiAgICBcclxuICAgIC8v0L3QsNGF0L7QtNC40Lwg0YHRgtC+0YDQvtC90YMg0LLRhdC+0LTQsCDRjdC70LXQvNC10L3RgtCwLiBcclxuICAgIC8v0LXRgdC70Lggc2lkZSA9PSB0cnVlLCDRgtC+INGN0LvQtdC80LXQvdGCINC00LLQuNCz0LDRjtGCINC40Lcg0LrQvtC90YbQsCDQutC+0L3RgtC10LnQvdC10YDQsCDQsiDQvdCw0YfQsNC70L4sINC4INC90LDQvtCx0L7RgNC+0YJcclxuICAgIGxldCBjb29yZHMgPSBnZXRDb29yZHModGhpcyk7XHJcbiAgICBsZXQgc2lkZSA9IGRyYWdPYmouZWxlbS5jbGFzc0xpc3QuY29udGFpbnMoXCJsaXN0XCIpID8gXHJcbiAgICAgICAgICAgICAgZS5wYWdlWCAtIGNvb3Jkcy5sZWZ0ID49IDEwMCA6IGUucGFnZVkgLSBjb29yZHMudG9wID49IDEwO1xyXG5cclxuICAgIC8v0L3QsNGF0L7QtNC40Lwg0Y3Qu9C10LzQtdC90YIg0L3QsCDQvNC10YHRgtC+INC60L7RgtC+0YDQvtCz0L4g0LzRiyDQv9C10YDQtdGC0LDRgdC60LjQstCw0LXQvCDQtNGA0YPQs9C+0Lkg0Y3Qu9C10LzQtdC90YJcclxuICAgIGxldCBlbGVtID0gdGhpcy5wYXJlbnROb2RlO1xyXG4gICAgaWYgKGRyYWdPYmouZWxlbS5jbGFzc0xpc3QuY29udGFpbnMoXCJsaXN0XCIpKSB7XHJcbiAgICAgIGlmICh0aGlzLmNsYXNzTGlzdC5jb250YWlucyhcImxpc3RcIikpIHtcclxuICAgICAgICAgIGVsZW0gPSB0aGlzLnBhcmVudE5vZGU7XHJcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5jbGFzc0xpc3QuY29udGFpbnMoXCJsaXN0X19jb250ZW50X19jYXJkXCIpKSB7XHJcbiAgICAgICAgICBlbGVtID0gdGhpcy5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgZWxlbSA9IHRoaXMucGFyZW50Tm9kZS5wYXJlbnROb2RlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8v0L/QtdGA0LXQvNC40YnQtdC90LjQtSDRjdC70LXQvNC10L3RgtC+0LIuIFxyXG4gICAgaWYgKHNpZGUpIHtcclxuICAgICBpZiAoZWxlbS5uZXh0RWxlbWVudFNpYmxpbmcgPT0gbnVsbCkge1xyXG4gICAgICAgIGxldCBkcmFnUGFyZW50ID0gZHJhZ09iai5wYXJlbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChkcmFnT2JqLnBhcmVudCk7XHJcbiAgICAgICAgZWxlbS5wYXJlbnROb2RlLmFwcGVuZENoaWxkKGRyYWdQYXJlbnQpO1xyXG4gICAgICB9IGVsc2UgaWYgKGVsZW0ucHJldmlvdXNFbGVtZW50U2libGluZyA9PSBudWxsKSB7XHJcbiAgICAgICAgZWxlbS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShkcmFnT2JqLnBhcmVudCwgZWxlbSk7XHJcbiAgICAgIH0gZWxzZSBpZiAoZWxlbS5uZXh0RWxlbWVudFNpYmxpbmcgPT0gZHJhZ09iai5wYXJlbnQpe1xyXG4gICAgICAgIGVsZW0ucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZHJhZ09iai5wYXJlbnQsIGVsZW0pOyBcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBsZXQgZWxlbVBhcmVudCA9IGVsZW0ucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoZHJhZ09iai5wYXJlbnQsIGVsZW0pO1xyXG4gICAgICAgIGRyYWdPYmoucGFyZW50LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGVsZW1QYXJlbnQsIGRyYWdPYmoucGFyZW50KTtcclxuICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaWYgKGVsZW0ucHJldmlvdXNFbGVtZW50U2libGluZyA9PSBudWxsKSB7XHJcbiAgICAgICAgICBlbGVtLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGRyYWdPYmoucGFyZW50LCBlbGVtKTtcclxuICAgICAgICB9IGVsc2UgaWYgKGVsZW0ucHJldmlvdXNFbGVtZW50U2libGluZyA9PSBkcmFnT2JqLnBhcmVudCkge1xyXG4gICAgICAgICAgICBlbGVtLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGVsZW0sIGRyYWdPYmoucGFyZW50KTsgXHJcbiAgICAgICAgfSBlbHNlIGlmIChlbGVtLm5leHRFbGVtZW50U2libGluZyA9PSBudWxsKSB7XHJcbiAgICAgICAgICBsZXQgZHJhZ1BhcmVudCA9IGRyYWdPYmoucGFyZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZHJhZ09iai5wYXJlbnQpO1xyXG4gICAgICAgICAgICBlbGVtLnBhcmVudE5vZGUuYXBwZW5kQ2hpbGQoZHJhZ1BhcmVudCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgZWxlbS5wYXJlbnROb2RlLmluc2VydEJlZm9yZSggZHJhZ09iai5wYXJlbnQsIGVsZW0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGRyYWdFbmQoZSkge1xyXG4gICAgbGV0IGVsZW0gPSB0aGlzLmNsYXNzTmFtZSA9PT0gXCJsaXN0X190aXRsZVwiID8gXHJcbiAgICAgIHRoaXMucGFyZW50Tm9kZSA6IHRoaXM7XHJcbiAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuaGlkZGVuQ2xvbmVFbGVtXCIpKTtcclxuICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZShcIm9wYWNpdHlaZXJvXCIpO1xyXG4gICAgZHJhZ09iaiA9IHt9O1xyXG4gIH1cclxuXHJcbiAgLy/QutC+0L7RgNC00LjQvdCw0YLRiyDQutCw0YDRgtC+0YfQutC4INC40LvQuCDQu9C40YHRgtCwXHJcbiAgZnVuY3Rpb24gIGdldENvb3JkcyhlbGVtKSB7IFxyXG4gICAgbGV0IGJveCA9IGVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB0b3A6IGJveC50b3AgKyBwYWdlWU9mZnNldCxcclxuICAgICAgbGVmdDogYm94LmxlZnQgKyBwYWdlWE9mZnNldFxyXG4gICAgfTtcclxuICB9Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
